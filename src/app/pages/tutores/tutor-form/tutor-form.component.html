<div class="tutor-form flex flex-col min-h-[calc(100vh-5rem)]">
  <div class="flex-1 bg-petrack-pale">
    <div class="max-w-xl mx-auto px-4 py-8">
      <a
        routerLink="/tutores"
        class="inline-flex items-center gap-2 text-gray-600 hover:text-petrack mb-6"
      >
        <lucide-icon name="arrow-left" [size]="20" />
        Voltar aos tutores
      </a>

      <h1 class="text-2xl font-bold text-petrack-dark mb-6">{{ title() }}</h1>

      @if (error$ | async; as error) {
        <div class="mb-4 p-3 rounded-xl bg-red-50 border border-red-200 text-red-700 text-sm">
          {{ error }}
        </div>
      }

      <form (ngSubmit)="onSubmit()" class="bg-white rounded-xl shadow-md border border-gray-100 p-6 space-y-4">
        @if (isEdit() && (selectedtutores$ | async); as tutor) {
          <div class="pb-4 border-b border-gray-100">
            <label class="block text-sm font-medium text-gray-700 mb-2">Foto do tutor</label>
            <div class="flex flex-wrap items-center gap-4">
              @if (tutor.foto?.url) {
                <img
                  [src]="tutor.foto?.url"
                  [alt]="tutor.foto?.nome || 'Foto do tutor'"
                  class="w-24 h-24 rounded-xl object-cover border border-gray-200"
                />
                <div class="flex flex-col gap-2">
                  <button
                    type="button"
                    (click)="removeFoto(tutor.id, tutor.foto?.id ?? 0)"
                    [disabled]="removeFotoLoading$ | async"
                    class="inline-flex items-center gap-2 px-3 py-2 rounded-xl border border-red-200 text-red-700 text-sm font-medium hover:bg-red-50 disabled:opacity-50"
                  >
                    <lucide-icon name="trash-2" [size]="16" />
                    Remover foto
                  </button>
                </div>
              }
              <label
                class="inline-flex items-center gap-2 px-4 py-2.5 rounded-xl border border-gray-200 bg-gray-50 text-gray-700 cursor-pointer hover:bg-gray-100 disabled:opacity-50"
                [class.pointer-events-none]="uploadFotoLoading$ | async"
              >
                <lucide-icon name="camera" [size]="18" />
                <span>{{ tutor.foto?.url ? 'Alterar foto' : 'Enviar foto' }}</span>
                <input
                  type="file"
                  accept="image/*"
                  class="hidden"
                  (change)="onPhotoSelected($event, tutor.id)"
                />
              </label>
            </div>
          </div>
        }
        <div>
          <label for="nome" class="block text-sm font-medium text-gray-700 mb-1">Nome</label>
          <input
            id="nome"
            type="text"
            [(ngModel)]="nome"
            name="nome"
            class="w-full px-4 py-2.5 rounded-xl border border-gray-200 focus:ring-2 focus:ring-petrack-light focus:border-petrack"
            placeholder="Nome do tutores"
          />
        </div>
        <div>
          <label for="email" class="block text-sm font-medium text-gray-700 mb-1">E-mail</label>
          <input
            id="email"
            type="email"
            [(ngModel)]="email"
            name="email"
            class="w-full px-4 py-2.5 rounded-xl border border-gray-200 focus:ring-2 focus:ring-petrack-light focus:border-petrack"
            placeholder="email@exemplo.com"
            autocomplete="email"
          />
        </div>
        <div>
          <label for="telefone" class="block text-sm font-medium text-gray-700 mb-1">Telefone</label>
          <input
            id="telefone"
            type="text"
            [ngModel]="telefoneDisplay"
            (ngModelChange)="onTelefoneInput($event)"
            name="telefone"
            maxlength="16"
            inputmode="numeric"
            class="w-full px-4 py-2.5 rounded-xl border border-gray-200 focus:ring-2 focus:ring-petrack-light focus:border-petrack"
            placeholder="(65) 99999-9999"
          />
        </div>
        <div>
          <label for="endereco" class="block text-sm font-medium text-gray-700 mb-1">Endereço</label>
          <input
            id="endereco"
            type="text"
            [(ngModel)]="endereco"
            name="endereco"
            class="w-full px-4 py-2.5 rounded-xl border border-gray-200 focus:ring-2 focus:ring-petrack-light focus:border-petrack"
            placeholder="Endereço completo"
          />
        </div>
        <div>
          <label for="cpf" class="block text-sm font-medium text-gray-700 mb-1">CPF</label>
          <input
            id="cpf"
            type="text"
            [ngModel]="cpfDisplay"
            (ngModelChange)="onCpfInput($event)"
            name="cpf"
            maxlength="14"
            inputmode="numeric"
            autocomplete="off"
            class="w-full px-4 py-2.5 rounded-xl border border-gray-200 focus:ring-2 focus:ring-petrack-light focus:border-petrack"
            placeholder="000.000.000-00"
          />
        </div>
        <div class="pt-4 flex gap-3">
          <button
            type="submit"
            [disabled]="saveLoading$ | async"
            class="inline-flex items-center gap-2 px-4 py-2.5 rounded-xl bg-petrack text-white font-medium hover:bg-petrack-dark disabled:opacity-50"
          >
            <lucide-icon name="save" [size]="18" />
            {{ isEdit() ? 'Salvar' : 'Cadastrar' }}
          </button>
          <a
            routerLink="/tutores"
            class="px-4 py-2.5 rounded-xl border border-gray-200 text-gray-700 hover:bg-gray-50"
          >
            Cancelar
          </a>
        </div>
      </form>
    </div>
  </div>
</div>
